---
import Layout from "../layouts/Layout.astro";
import { loadQuery } from "../sanity/lib/load-query";
import { urlForImage } from "../sanity/lib/url-for-image";

// Query to get the first 5 images from all galleries
const GALLERY_IMAGES_QUERY = `*[_type == "post" || _type == "page"]{
  "allImages": content[_type == "gallery"][].images[]{
    asset,
    alt
  }
}[defined(allImages) && count(allImages) > 0][0].allImages[0...5]`;

const { data: images } = await loadQuery<Array<{asset: any, alt?: string}>>({
  query: GALLERY_IMAGES_QUERY,
});
---
<script>
document.addEventListener('DOMContentLoaded', () => {
	const cursor = document.querySelector('.cursor');
	if (!cursor) return;
	const label = cursor.querySelector('.cursor-label');
	const projects = document.querySelectorAll('details.project');

	let mouseX = 0;
	let mouseY = 0;
	let curX = 0;
	let curY = 0;
	const EASE = 0.067;

	window.addEventListener('mousemove', (e) => {
		mouseX = e.clientX;
		mouseY = e.clientY;
	});

	window.addEventListener('mouseleave', () => {
		cursor.classList.remove('is-active');
	});

	function loop() {
		if (!cursor) return;
		curX += (mouseX - curX) * EASE;
		curY += (mouseY - curY) * EASE;
		// keep the -50% offset so the circle's center aligns with the pointer
		const circle = cursor.querySelector('.cursor-circle');
		if (circle) {
			const cursorRect = cursor.getBoundingClientRect();
			const circleRect = circle.getBoundingClientRect();
			const offsetX = (circleRect.left - cursorRect.left) + circleRect.width / 2;
			const offsetY = (circleRect.top - cursorRect.top) + circleRect.height / 2;
			cursor.style.transform = `translate(${curX - offsetX}px, ${curY - offsetY}px)`;
		}
		requestAnimationFrame(loop);
	}

	loop();

	projects.forEach((el) => {
		const summary = el.querySelector('summary');

		el.addEventListener('mouseenter', () => {
			const text = summary ? summary.textContent?.trim() : '';
			if (label) label.textContent = text || '';
			cursor.classList.add('is-active');
		});

		el.addEventListener('mouseleave', () => {
			cursor.classList.remove('is-active');
			if (label) label.textContent = '';
		});
	});
});
</script>


<Layout title="Home">
  <section class="panel panel-1">
    <div class="hero-text">
      <h1>Matthijs</h1>
      <h2>Portfolio</h2>
      <h2>Frontend Developer</h2>
    </div>
  </section>

  <section class="panel panel-2">
	<div class="section-title">
		<h3>Work</h3>
		<a href="/work" class="view-all">
			bekijk alles
			<svg fill="white" width="15px" height="15px" viewBox="0 0 15 15" xmlns="http://www.w3.org/2000/svg" id="arrow">
				<path d="M8.29289 2.29289C8.68342 1.90237 9.31658 1.90237 9.70711 2.29289L14.2071 6.79289C14.5976 7.18342 14.5976 7.81658 14.2071 8.20711L9.70711 12.7071C9.31658 13.0976 8.68342 13.0976 8.29289 12.7071C7.90237 12.3166 7.90237 11.6834 8.29289 11.2929L11 8.5H1.5C0.947715 8.5 0.5 8.05228 0.5 7.5C0.5 6.94772 0.947715 6.5 1.5 6.5H11L8.29289 3.70711C7.90237 3.31658 7.90237 2.68342 8.29289 2.29289Z"/>
			</svg>
		</a>
	</div>
    <details class="project" open>
      <summary>Dutch Digital Agencies</summary>
      <img src="/src/assets/dda-background.png" alt="website screenshot dda">
      <div class="work-info">
        <p>Development / Projecten /</p>
        <p class="date"><time datetime="2025-10-01">1 oktober, 2025</p>
      </div>
    </details>

    <details class="project" open>
      <summary>Q42</summary>
      <img src="/src/assets/dda-background.png" alt="website screenshot dda">
      <div class="work-info">
        <p>Development / Projecten /</p>
        <p class="date"><time datetime="2025-10-01">1 oktober, 2025</p>
      </div>
    </details>

    <details class="project" open>
      <summary>Bijlmer Chronicles</summary>
      <img src="/src/assets/dda-background.png" alt="website screenshot dda">
      <div class="work-info">
        <p>Development / Projecten /</p>
        <p class="date"><time datetime="2025-10-01">1 oktober, 2025</p>
      </div>
    </details>
	 <div class="section-title">
		<h3>About me</h3>
		<a href="/work" class="view-all">
			bekijk alles
			<svg fill="white" width="15px" height="15px" viewBox="0 0 15 15" xmlns="http://www.w3.org/2000/svg" id="arrow">
				<path d="M8.29289 2.29289C8.68342 1.90237 9.31658 1.90237 9.70711 2.29289L14.2071 6.79289C14.5976 7.18342 14.5976 7.81658 14.2071 8.20711L9.70711 12.7071C9.31658 13.0976 8.68342 13.0976 8.29289 12.7071C7.90237 12.3166 7.90237 11.6834 8.29289 11.2929L11 8.5H1.5C0.947715 8.5 0.5 8.05228 0.5 7.5C0.5 6.94772 0.947715 6.5 1.5 6.5H11L8.29289 3.70711C7.90237 3.31658 7.90237 2.68342 8.29289 2.29289Z"/>
			</svg>
		</a>
	</div>
	<h4>Reizen</h4>
	<p>Ik heb echt al heel veel mooie plekken op de aarde mogen zien, maar ik ben nog lang niet klaar. Van Amerika naar AziÃ« naar Zuid-Afrika. Ik wil het liefst de hele wereld zien.</p>
	<div class="travel-images">
		{images && images.map((img) => (
			<img 
				src={urlForImage(img.asset).width(800).url()} 
				alt={img.alt || 'Travel photo'} 
				loading="lazy"
			/>
		))}
	</div>
  </section>

  <div class="cursor">
    <div class="cursor-circle"></div>
    <span class="cursor-label"></span>
  </div>
</Layout>

<style>
  :global(body) {
    background-color: #000000;
    color: white;
    overflow: auto;
  }

  main {
    height: 100vh;
  }

  .hero-text {
    position: absolute;
    bottom: 15vh;
    display: grid;
    grid-template-rows: repeat(3, min-content);
    line-height: 1.1;
    margin-left: 5vw;
  }

  h1 {
    font-size: clamp(6rem, 10vw, 14rem);
    grid-row: 2;
  }

  h2 {
    font-size: 2rem;
  }

  .panel {
    position: sticky;
    top: 0;
    height: 100vh;
  }

  .panel-2 {
    height: min-content;
    padding: 1rem;
    background: #222;
    display: flex;
    flex-direction: column;
  }
  .section-title {
	display: flex;
	flex-direction: column;
	justify-content: space-between;
	margin: 1rem 0 2rem 0;
	line-height: 1;
	@media (min-width: 400px) {
		flex-direction: row;
	}
	& a {
	  display: flex;
	  align-items: center;
	  gap: 0.5rem;
	  text-decoration: none;
	  color: white;
	  margin-top: .5rem;
	  & svg {
		transition: transform 0.15s ease;
	  }
	  &:hover {
		svg {
		  transform: translateX(5px);
		  transition: transform 0.15s ease;
	  	}
	  }
	}
  }
  .panel-2 h3 {
    font-size: clamp(4rem, 10vw, 6rem);
  }

  .panel-2 details {
    padding: 1rem;
    border: 1px solid #989898;
	margin-bottom: 1rem;
  }

  .panel-2 details .work-info {
    margin-top: .25rem;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
	& .date {
	  color: #9a9999;
	}
  }

  @media (min-width: 400px) {
    .panel-2 details .work-info {
      flex-direction: row;
    }
  }

  .panel-2 details summary {
    list-style-type: none;
    position: relative;
    display: flex;
    text-transform: uppercase;
  }

  .panel-2 details summary::after {
    transform: rotate(0deg);
    transition: transform 0.3s ease;
  }

  .panel-2 details[open] summary {
    margin-bottom: .5rem;
  }

  .panel-2 details[open]:hover summary::after {
    transform: rotate(90deg);
  }

  .panel-2 details:hover summary::after {
    transform: rotate(45deg);
  }

  .panel-2 details[open] summary::after {
    transform: rotate(45deg);
  }

  details > summary::after {
    content: url(/src/assets/Arrow.svg);
    display: inline-block;
    position: absolute;
    right: 0;
    transition: transform 0.3s ease;
  }

  .cursor {
    position: fixed;
    left: 0;
    top: 0;
    pointer-events: none;
    opacity: 0;
    transform: translate(-50%, -50%);
    transition: opacity 0.15s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    mix-blend-mode: difference;
    color: #fff;
    z-index: 9999;
  }
  .cursor-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: #ffffff;
    background-size: cover;
    background-position: center;
    flex-shrink: 0;
  }
  .cursor-label {
    font-size: 16px;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    white-space: nowrap;
  }
  .cursor.is-active {
    opacity: 1;
  }

  .travel-images {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .travel-images img {
    width: 100%;
    height: 250px;
    object-fit: cover;
    border-radius: 4px;
  }

</style>
